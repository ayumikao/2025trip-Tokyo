<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>2025 è¡Œç¨‹ï½œæ¾€è°·â†’éŒå€‰â†’ç®±æ ¹â†’ç†±æµ·â†’ä¼Šè±†åŠå³¶</title>
<style>
  :root{--bg:#0b1020;--fg:#eef1f7;--muted:#a6b0c2;--card:#131a2b;--acc:#6ea8fe}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0b1020,#111a30 40%,#0b1020);color:var(--fg);font-family:system-ui,-apple-system,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif}
  header{padding:18px 20px;border-bottom:1px solid #1f2a44;position:sticky;top:0;background:rgba(11,16,32,.9);backdrop-filter: blur(8px);z-index:2}
  h1{margin:0;font-size:18px;letter-spacing:.5px}
  .tabs{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
  .tab{padding:8px 12px;border-radius:999px;border:1px solid #28406d;cursor:pointer;color:#cfe1ff}
  .tab.active{background:linear-gradient(135deg,#244a8b,#6ea8fe);color:#081126;border-color:transparent;font-weight:700}
  .container{display:grid;grid-template-columns: minmax(280px,1fr) minmax(320px,520px); gap:14px; padding:14px}
  .card{background:rgba(19,26,43,.6);border:1px solid #1f2a44;border-radius:16px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,.35)}
  iframe{width:100%;height:70vh;border:0;display:block;background:#0b0f1d}
  .right{padding:14px}
  .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px}
  .gallery.hidden{display:none}
  .ph{border-radius:10px;overflow:hidden;background:#0f1527;border:1px solid #26325a}
  .ph img{width:100%;display:block}
  .hint{color:var(--muted);font-size:13px;margin:6px 0 10px}
  .section-title{font-size:14px;margin:0 0 8px;color:#cfe1ff}
  .timeline{padding:12px}
  table{width:100%;border-collapse: collapse;font-size:14px}
  th,td{border-bottom:1px solid #1f2a44;padding:8px 6px;text-align:left;vertical-align:top}
  .muted{color:var(--muted)}
  .poi-link{color:#b7d2ff;text-decoration:none;border-bottom:1px dotted #517bd9}
  footer{padding:20px;color:#8ea2c8;text-align:center}
  .badge{display:inline-block;padding:2px 8px;border:1px solid #28406d;border-radius:999px;font-size:12px;color:#9fc0ff;margin-left:6px}
  #err{margin:0 14px 14px;color:#ffaeae;font-size:12px}
</style>
</head>
<body>
<header>
  <h1>2025 æ±äº¬è¿‘éƒŠæ—…ï½œæ¾€è°· â†’ éŒå€‰ â†’ ç®±æ ¹ â†’ ç†±æµ· â†’ ä¼Šè±†åŠå³¶ <span class="badge">GitHub Pages</span></h1>
  <div class="tabs">
    <div class="tab active" data-day="2025-09-20">9/20 éŒå€‰</div>
    <div class="tab" data-day="2025-09-21" title="å°šæœªå»ºç½®">9/21</div>
    <div class="tab" data-day="2025-09-22" title="å°šæœªå»ºç½®">9/22</div>
    <div class="tab" data-day="2025-09-23" title="å°šæœªå»ºç½®">9/23</div>
  </div>
</header>

<main class="container">
  <section class="card">
    <iframe id="mapFrame" src="map-2025-09-20-from-csv-v4-bridge-bomfix.html" loading="lazy"></iframe>
  </section>
  <aside class="card right">
    <div class="section-title">ç…§ç‰‡ç‰†</div>
    <div class="hint" id="hint">åœ¨å·¦é‚Šåœ°åœ–é»é¸ä»»ä¸€æ™¯é»æ¨™è¨˜ï¼Œæˆ‘æœƒé¡¯ç¤ºè©²æ™¯é»çš„ç›¸ç°¿ã€‚</div>
    <div id="gallery" class="gallery hidden"></div>
  </aside>
</main>

<section class="card timeline" style="margin:0 14px 14px">
  <div class="section-title">æ™‚é–“è»¸ï¼ˆ9/20 +15åˆ†é˜ç·©è¡ç‰ˆï¼‰</div>
  <div class="hint">è³‡æ–™ä¾†è‡ªï¼š<code>timeline-2025-09-20_v4.csv</code></div>
  <div id="timeline"></div>
</section>
<p id="err"></p>
<footer>Â© 2025 Ayumi è¡Œç¨‹åœ°åœ–</footer>

<script>
const DAY_CFG = {"2025-09-20":{map:"map-2025-09-20-from-csv-v4-bridge-bomfix.html",photosCSV:"photos-2025-09-20-mapped.csv",timelineCSV:"timeline-2025-09-20_v4.csv"}};

function parseCSV(text){
  const rows = []; let row = [], field = '', inQuotes = false;
  for(let i=0;i<text.length;i++){
    const c = text[i], n = text[i+1];
    if(c === '"'){ if(inQuotes && n === '"'){ field += '"'; i++; } else inQuotes = !inQuotes; }
    else if(c === ',' && !inQuotes){ row.push(field); field=''; }
    else if((c === '\n' || c === '\r') && !inQuotes){
      if(field !== '' || row.length){ row.push(field); rows.push(row); row=[]; field=''; }
      if(c === '\r' && n === '\n'){ i++; }
    } else { field += c; }
  }
  if(field !== '' || row.length){ row.push(field); rows.push(row); }
  let header = rows.shift() || [];
  header = header.map(h => (h||'').replace(/^\uFEFF/,'').trim()); // BOM
  return rows.filter(r=>r.length && r.some(x=>x && x.trim()!=='')).map(cols => {
    const obj = {}; header.forEach((h,i)=> obj[h] = (cols[i]||'').trim()); return obj;
  });
}
function normalizeTitle(t){ return (t||"").replace(/^[0-9â‘ -â‘³\.\s]+/g,'').trim(); }
function pick(row, names){
  const keys = Object.keys(row).map(k=>k.replace(/\s/g,'').replace(/\uFEFF/g,''));
  for(const cand of names){
    const want = cand.replace(/\s/g,'');
    for(let i=0;i<keys.length;i++){ if(keys[i]===want) return row[Object.keys(row)[i]]; }
  } return "";
}
let photosData=[];
async function loadPhotos(csvPath){
  const r=await fetch(csvPath); if(!r.ok){document.getElementById('err').textContent='ç…§ç‰‡CSVè¼‰å…¥å¤±æ•—ï¼š'+r.status; return;}
  const t=await r.text(); photosData=parseCSV(t);
}
function renderPhotos(place){
  const g=document.getElementById('gallery'); const hint=document.getElementById('hint');
  g.innerHTML=''; const title=normalizeTitle(place);
  const rows=photosData.filter(r => normalizeTitle(r["å°æ‡‰åœ°é»"])===title);
  if(!rows.length){ hint.textContent=`é€™å€‹æ™¯é»æš«ç„¡ç›¸ç‰‡ï¼š${title}`; g.classList.add('hidden'); return; }
  hint.textContent=`${title} çš„ç›¸ç‰‡ï¼š`; g.classList.remove('hidden');
  for(const r of rows){ const div=document.createElement('div'); div.className='ph'; div.innerHTML=`<img loading="lazy" alt="${r.title||title}" src="${r.image}">`; g.appendChild(div); }
}
async function loadTimeline(csvPath){
  const r=await fetch(csvPath); if(!r.ok){document.getElementById('err').textContent='æ™‚é–“è»¸CSVè¼‰å…¥å¤±æ•—ï¼š'+r.status; return;}
  const t=await r.text(); const rows=parseCSV(t);
  const wrap=document.getElementById('timeline'); const tbl=document.createElement('table');
  tbl.innerHTML='<thead><tr><th>æ™‚é–“</th><th>åœ°é» / æ´»å‹•</th><th>å‚™è¨»</th><th>é¡åˆ¥</th></tr></thead>'; const tb=document.createElement('tbody');
  for(const row of rows){
    const time=(pick(row,["æ™‚é–“èµ·"])||"") + ((pick(row,["æ™‚é–“è¿„"])||"")?`â€“${pick(row,["æ™‚é–“è¿„"])}`:"");
    const place=pick(row,["åœ°é»/æ´»å‹•"])||row["åœ°é» / æ´»å‹•"]||""; const link=pick(row,["ğŸ“æ™¯é»é€£çµ"])||row["ğŸ“ æ™¯é»é€£çµ"]||"";
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${time}</td><td>${place} ${link?`<a class="poi-link" target="_blank" href="${link}">ğŸ“</a>`:""}</td><td class="muted">${pick(row,["å‚™è¨»"])||""}</td><td class="muted">${pick(row,["é¡åˆ¥"])||""}</td>`;
    tb.appendChild(tr);
  } tbl.appendChild(tb); wrap.innerHTML=''; wrap.appendChild(tbl);
}
// tabs
document.querySelectorAll('.tab').forEach(el=>{
  el.addEventListener('click',()=>{
    const day=el.dataset.day; document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); el.classList.add('active');
    const cfg=DAY_CFG[day]; const iframe=document.getElementById('mapFrame');
    if(cfg){ iframe.src=cfg.map; loadPhotos(cfg.photosCSV); loadTimeline(cfg.timelineCSV); document.getElementById('gallery').classList.add('hidden'); document.getElementById('hint').textContent="åœ¨å·¦é‚Šåœ°åœ–é»é¸ä»»ä¸€æ™¯é»æ¨™è¨˜ï¼Œæˆ‘æœƒé¡¯ç¤ºè©²æ™¯é»çš„ç›¸ç°¿ã€‚"; }
    else{ iframe.src="about:blank"; document.getElementById('timeline').innerHTML="<div class='muted'>é€™ä¸€å¤©å°šæœªå»ºç½®</div>"; document.getElementById('gallery').classList.add('hidden'); document.getElementById('hint').textContent="æ­¤æ—¥æœŸå°šæœªå»ºç½®"; }
  });
});
window.addEventListener('message',(ev)=>{ const d=ev.data||{}; if(d.type==='marker-click' && d.place){ renderPhotos(d.place); } });
(async()=>{ const cfg=DAY_CFG["2025-09-20"]; await loadPhotos(cfg.photosCSV); await loadTimeline(cfg.timelineCSV); })();
</script>
</body>
</html>
