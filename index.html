<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>2025 東京近郊旅遊</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { background:#0d1117; color:#fff; font-family: sans-serif; margin:0; padding:0; }
    h1 { text-align:center; margin:10px; }
    .date-buttons { display:flex; justify-content:center; gap:10px; margin:10px; }
    .date-buttons button {
      background:#111; color:#fff; border:2px solid #444; border-radius:20px;
      padding:10px 15px; font-size:14px; cursor:pointer;
    }
    .date-buttons button.active { background:#1f6feb; border-color:#1f6feb; }
    #map { height:300px; margin:10px; border-radius:10px; overflow:hidden; position:relative; }
    .map-control-right { position:absolute; top:100px; right:10px; display:flex; flex-direction:column; gap:5px; z-index:1000; }
    .map-control-right button {
      background:#161b22; color:#fff; border:none; padding:8px; border-radius:8px; cursor:pointer;
    }
    #photos { margin:10px; padding:10px; background:#161b22; border-radius:10px; }
    #photos h2 { font-size:16px; margin:0 0 5px 0; }
    #photos .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(100px,1fr)); gap:5px; }
    #photos img { width:100%; border-radius:5px; }
    #timeline { margin:10px; padding:10px; background:#161b22; border-radius:10px; }
    #timeline h2 { font-size:16px; margin:0 0 5px 0; }
    table { width:100%; border-collapse:collapse; font-size:14px; }
    th, td { border-bottom:1px solid #333; padding:6px; vertical-align:top; }
    th { background:#111; }
    .mapcode { background:#333; color:#FFD700; padding:3px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <h1>2025 東京近郊旅遊</h1>
  <div class="date-buttons">
    <button class="active">09/20<br>鎌倉</button>
    <button>09/21<br>箱根</button>
    <button>09/22<br>熱海</button>
    <button>09/23<br>伊豆半島</button>
  </div>
  <div id="map"></div>
  <div class="map-control-right">
    <button id="locateBtn">我在這</button>
    <button id="followBtn">跟隨我</button>
  </div>

  <div id="photos">
    <h2>照片牆（點任一標記顯示相簿）</h2>
    <div id="photoGrid" class="grid">暫無照片</div>
  </div>

  <div id="timeline">
    <h2>時間軸（9/20 +15 分鐘緩衝版）</h2>
    <table>
      <thead><tr><th>時間</th><th>地點 / 活動</th><th>類別</th><th>Map Code</th></tr></thead>
      <tbody id="timelineBody"></tbody>
    </table>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script>
    // 初始化地圖
    const map = L.map('map').setView([35.318,139.55], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // 我在這/跟隨我
    let userMarker, follow=false;
    document.getElementById('locateBtn').onclick = ()=>{
      navigator.geolocation.getCurrentPosition(pos=>{
        const latlng=[pos.coords.latitude,pos.coords.longitude];
        if(!userMarker) userMarker=L.marker(latlng).addTo(map);
        else userMarker.setLatLng(latlng);
        map.setView(latlng,15);
      });
    };
    document.getElementById('followBtn').onclick = ()=>{
      follow=!follow;
      if(follow){
        navigator.geolocation.watchPosition(pos=>{
          const latlng=[pos.coords.latitude,pos.coords.longitude];
          if(!userMarker) userMarker=L.marker(latlng).addTo(map);
          else userMarker.setLatLng(latlng);
          map.setView(latlng,15);
        });
      }
    };

    // 載入照片 CSV
    Papa.parse('photos-2025-09-20-mapped.csv', {
      download:true, header:true, complete:(res)=>{
        const grid=document.getElementById('photoGrid');
        grid.innerHTML='';
        if(res.data.length===0){ grid.innerHTML='暫無照片'; return; }
        res.data.forEach(r=>{
          if(r.url){
            const img=document.createElement('img');
            img.src=r.url; grid.appendChild(img);
          }
        });
      }
    });

    // 載入時間軸 CSV
    Papa.parse('timeline-2025-09-20_v6.csv', {
      download:true, header:true, complete:(res)=>{
        const body=document.getElementById('timelineBody');
        res.data.forEach(r=>{
          if(!r.時間) return;
          const tr=document.createElement('tr');
          tr.innerHTML=`
            <td>${r.時間}</td>
            <td>${r['地點/活動']||''}<br>${r.備註||''}</td>
            <td>${r.類別||''}</td>
            <td><span class="mapcode">${r.MapCode||''}</span></td>`;
          body.appendChild(tr);
        });
      }
    });
  </script>
</body>
</html>
