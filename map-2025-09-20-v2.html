<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>9/20 澀谷 → 鎌倉｜互動地圖（v2）</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  html,body,#map{height:100%;margin:0}
  .legend{background:#fff;padding:8px 10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.15);font:12px/1.5 system-ui,-apple-system,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif}
  .legend .dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;vertical-align:middle}
  .card{font-family:system-ui,-apple-system,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;min-width:240px;max-width:300px}
  .card h3{margin:0 0 6px;font-size:16px}
  .meta{color:#667;font-size:12px;margin:4px 0 6px}
  .tag{display:inline-block;border:1px solid #ccd;padding:2px 6px;border-radius:999px;font-size:12px;text-decoration:none;color:#223;margin-right:6px;margin-top:4px}
  .muted{color:#789}
</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// Map base
const map = L.map('map').setView([35.318,139.55], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19, attribution: '&copy; OpenStreetMap'}).addTo(map);

// Layers
const Lmain = L.layerGroup().addTo(map);
const Lopt = L.layerGroup().addTo(map);
const Ltoilet = L.layerGroup().addTo(map);

// Icons
function icon(color){ return L.divIcon({
  className:'', iconSize:[28,28], iconAnchor:[14,14], popupAnchor:[0,-10],
  html:`<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="14" cy="14" r="12" fill="white" stroke="${color}" stroke-width="2"/>
    <circle cx="14" cy="14" r="6" fill="${color}"/>
  </svg>`
});}
const icMain = icon('#2E86DE');
const icOpt  = icon('#9B59B6');
const icWC   = icon('#27AE60');

function addMarker(layer, lat, lng, title, time, note, link){
  const m = L.marker([lat,lng], {icon: layer===Lopt?icOpt:layer===Ltoilet?icWC:icMain}).addTo(layer);
  const linkHtml = link?`<a class="tag" target="_blank" href="${link}">📍 Google 地圖</a>`:'';
  m.bindPopup(`<div class="card"><h3>${title}</h3>${time?`<div class="meta">${time}</div>`:''}${note?`<div class="muted">${note}</div>`:''}${linkHtml}</div>`);
  return m;
}

// === Route points (approx) ===
const seq = [];
seq.push(addMarker(Lmain, 35.6580,139.7016, "澀谷出發（包車）", "06:30–08:00", "預留 1.5 小時車程（含早高峰小堵車）", ""));
addMarker(Ltoilet, 35.3099,139.5277, "🚻 7-11 鎌倉七里ガ浜店", "", "距離七高正門前約 4 分車程；有停車位，廁所對外開放", ""); 

seq.push(addMarker(Lmain, 35.3114,139.5341, "① 七高正門前（私人拍照點）", "08:00–08:20", "灌籃高手場景，清晨光線好", ""));
seq.push(addMarker(Lmain, 35.3069,139.5259, "② 顯証寺（私人拍照點）", "08:20–08:50", "早光線柔和、人少；🚻 無公廁（需到錢洗弁財天或小町通）", ""));

seq.push(addMarker(Lmain, 35.332861,139.518890, "③ 湘南深澤站（倒掛鐵路）", "09:00–09:30", "約 7 分鐘一班車，可拍 3–4 班；🚻 西口有公廁", ""));

// Zeniarai (approx)
seq.push(addMarker(Lmain, 35.3249,139.5451, "④ 錢洗弁財天 宇賀福神社", "09:40–10:50", "水洗錢會發大財；線香+蠟燭+籃子 200 日幣；入口右側有簡易廁所", ""));

seq.push(addMarker(Lmain, 35.3213,139.5566, "⑤ 小町通商店街（600m）", "11:00–13:30", "多店 10:00 開；茶茶／長頸鹿咖哩麵包／章魚天婦羅／奶油鴿子餅乾／卡士達大佛／小黃瓜 250；7-11 有伴手禮；🚻 多處公廁", ""));

// Optional Hachimangu
addMarker(Lopt, 35.3269,139.5591, "（可有可無）鶴岡八幡宮（抽御手）", "12:50–13:50", "境內公廁", "");

seq.push(addMarker(Lmain, 35.3167,139.5352, "⑥ 高德院（鎌倉大佛）", "13:45–14:45", "開放 8:00–17:30；大人 300／小學生 150（現金）；+50 入內；寺內與出口有廁所", ""));

// Enoshima shopping and lodging and sunset
addMarker(Lopt, 35.3088,139.4900, "（可有可無）YAMAKA 江之島店", "15:00–15:50", "伴手禮購物；店內有廁所", "");
seq.push(addMarker(Lmain, 35.3109,139.4857, "⑦ Rana 片瀬江ノ島", "15:55–16:15", "本日住宿 16:00–10:00", ""));
seq.push(addMarker(Lmain, 35.2988,139.4806, "⑧ 江之島（看夕陽）", "16:50–18:30", "手扶梯：大人 360／小學生 180；青銅鳥居入口、商店街、伴手禮；傍晚需外套；🚻 島入口、各神社與商店街均有廁所", ""));

// Draw polyline
const latlngs = seq.map(m => m.getLatLng());
L.polyline(latlngs, {color:'#2E86DE', weight:4, opacity:.85}).addTo(Lmain);

// Fit bounds
map.fitBounds(L.latLngBounds(latlngs), {padding:[30,30]});

// Layer control
L.control.layers(null, {
  "主行程": Lmain,
  "可有可無": Lopt,
  "🚻 廁所": Ltoilet
}, {collapsed:false, position:'topleft'}).addTo(map);

// Legend
const legend = L.control({position:'bottomleft'});
legend.onAdd = function(){
  const div = L.DomUtil.create('div','legend');
  div.innerHTML = `
    <div><span class="dot" style="background:#2E86DE"></span>主行程</div>
    <div><span class="dot" style="background:#9B59B6"></span>可有可無</div>
    <div><span class="dot" style="background:#27AE60"></span>🚻 廁所</div>
    <div class="muted" style="margin-top:6px">提示：點圖標看詳情，可開導航；座標為近似值，可提供精準點位給我微調。</div>`;
  return div;
};
legend.addTo(map);
</script>
</body>
</html>
